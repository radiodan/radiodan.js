#!/usr/bin/env node
var program = require('commander'),
    path    = require('path'),
    package = require('../package.json')
    configFile = 'config.json';

program
  .version(package.version)
  .usage('[options] config_file')
  .parse(process.argv);

switch(true) {
  case program.args.length == 1:
    configFile = program.args[0];
    break;
  case program.args.length > 1:
    program.help();
    break;
  default:
    //No config leaves us with defaults
}

var Radiodan = require(__dirname+'/../lib/radiodan'),
    radios = [];

try {
  var config = require(path.relative(__dirname, configFile));
} catch(err) {
  program.help();
  process.exit(1);
}

for(var i=0; i < config.radios.length; i++) {
  var radioConfig = config.paths;
  radioConfig.name = config.radios[i].name;
  var radiodan = Radiodan.create(config.paths, config.radios[i])
  radiodan.start();

  if(i === 0) {
    radiodan.client.playAllRandom();
  } else {
    radiodan.client.playAllRandomAsync();
  }

  radios.push(radiodan);
}
